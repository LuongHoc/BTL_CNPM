@model IEnumerable<WebDatTourDuLichOnline.Models.DonDatTour>

@{
    ViewData["Title"] = "Đơn đặt tour của tôi";
}

<!-- Page Header -->
<div class="page-header mb-4">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h2 class="fw-bold mb-1">
                <i class="bi bi-bag-check text-primary me-2"></i>
                Đơn đặt tour của tôi
            </h2>
            <p class="text-muted mb-0">Quản lý và theo dõi các đơn đặt tour của bạn</p>
        </div>
        <div>
            <a asp-controller="Home" asp-action="Index" class="btn btn-outline-primary">
                <i class="bi bi-plus-circle me-2"></i>Đặt tour mới
            </a>
        </div>
    </div>
</div>

@if (!Model.Any())
{
    <!-- Empty State -->
    <div class="empty-state">
        <div class="empty-state-icon">
            <i class="bi bi-inbox"></i>
        </div>
        <h4 class="empty-state-title">Chưa có đơn đặt tour nào</h4>
        <p class="empty-state-text">
            Bạn chưa đặt tour nào. Hãy khám phá các tour du lịch hấp dẫn của chúng tôi!
        </p>
        <a asp-controller="Home" asp-action="Index" class="btn btn-primary btn-lg mt-3">
            <i class="bi bi-compass me-2"></i>Khám phá tour
        </a>
    </div>
}
else
{
    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="stat-card stat-card-primary">
                <div class="stat-card-icon">
                    <i class="bi bi-clipboard-check"></i>
                </div>
                <div class="stat-card-body">
                    <div class="stat-card-value">@Model.Count()</div>
                    <div class="stat-card-label">Tổng đơn</div>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="stat-card stat-card-warning">
                <div class="stat-card-icon">
                    <i class="bi bi-hourglass-split"></i>
                </div>
                <div class="stat-card-body">
                    <div class="stat-card-value">@Model.Count(d => d.TrangThaiDon == "ChoXacNhan")</div>
                    <div class="stat-card-label">Chờ xác nhận</div>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="stat-card stat-card-success">
                <div class="stat-card-icon">
                    <i class="bi bi-check-circle"></i>
                </div>
                <div class="stat-card-body">
                    <div class="stat-card-value">@Model.Count(d => d.TrangThaiDon == "DaXacNhan")</div>
                    <div class="stat-card-label">Đã xác nhận</div>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="stat-card stat-card-info">
                <div class="stat-card-icon">
                    <i class="bi bi-wallet2"></i>
                </div>
                <div class="stat-card-body">
                    <div class="stat-card-value">@Model.Sum(d => d.TongTien).ToString("N0")</div>
                    <div class="stat-card-label">Tổng giá trị (VNĐ)</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Orders List -->
    <div class="orders-container">
        @foreach (var don in Model.OrderByDescending(d => d.NgayDat))
        {
            <div class="order-card mb-3">
                <div class="order-card-header">
                    <div class="order-info">
                        <div class="order-id">
                            <i class="bi bi-hash"></i>
                            <strong>@don.MaDon</strong>
                        </div>
                        <div class="order-date">
                            <i class="bi bi-calendar3 me-1"></i>
                            @don.NgayDat.ToString("dd/MM/yyyy HH:mm")
                        </div>
                    </div>
                    <div class="order-status">
                        @switch (don.TrangThaiDon)
                        {
                            case "ChoXacNhan":
                                <span class="badge-status warning">
                                    <i class="bi bi-clock-history me-1"></i>Chờ xác nhận
                                </span>
                                break;
                            case "DaXacNhan":
                                <span class="badge-status success">
                                    <i class="bi bi-check-circle me-1"></i>Đã xác nhận
                                </span>
                                break;
                            case "DaHuy":
                                <span class="badge-status danger">
                                    <i class="bi bi-x-circle me-1"></i>Đã hủy
                                </span>
                                break;
                            case "HoanThanh":
                                <span class="badge-status info">
                                    <i class="bi bi-check2-all me-1"></i>Hoàn thành
                                </span>
                                break;
                            default:
                                <span class="badge-status secondary">@don.TrangThaiDon</span>
                                break;
                        }
                    </div>
                </div>

                <div class="order-card-body">
                    <div class="row g-3">
                        <div class="col-md-8">
                            <div class="tour-info-section">
                                <h5 class="tour-name">
                                    <i class="bi bi-geo-alt text-primary me-2"></i>
                                    @don.Tour?.TenTour
                                </h5>

                                <div class="tour-details">
                                    <div class="detail-item">
                                        <i class="bi bi-calendar-check"></i>
                                        <span class="detail-label">Khởi hành:</span>
                                        <span class="detail-value">@don.Tour?.NgayKhoiHanh.ToString("dd/MM/yyyy")</span>
                                    </div>
                                    <div class="detail-item">
                                        <i class="bi bi-people"></i>
                                        <span class="detail-label">Số khách:</span>
                                        <span class="detail-value">@don.SoNguoiLon người lớn, @don.SoTreEm trẻ em</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="payment-section">
                                <div class="payment-status mb-3">
                                    @if (don.TrangThaiThanhToan == "DaThanhToan")
                                    {
                                        <span class="badge-payment success">
                                            <i class="bi bi-credit-card-2-front me-1"></i>
                                            Đã thanh toán
                                        </span>
                                    }
                                    else
                                    {
                                        <span class="badge-payment warning">
                                            <i class="bi bi-exclamation-circle me-1"></i>
                                            Chưa thanh toán
                                        </span>
                                    }
                                </div>

                                <div class="total-price">
                                    <div class="price-label">Tổng tiền</div>
                                    <div class="price-value">@don.TongTien.ToString("N0") VNĐ</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="order-card-footer">
                    <div class="action-buttons">
                        <a asp-controller="Tour" asp-action="ChiTiet" asp-route-id="@don.TourId"
                           class="btn btn-outline-primary btn-sm">
                            <i class="bi bi-eye me-1"></i>Xem tour
                        </a>

                        @* Hủy đơn (nếu còn cho phép) *@
                        @if (don.TrangThaiDon == "ChoXacNhan" || don.TrangThaiDon == "DaXacNhan")
                        {
                            <form asp-action="HuyDon" method="post" class="d-inline"
                                  onsubmit="return confirm('Bạn có chắc muốn hủy đơn này?');">
                                <input type="hidden" name="id" value="@don.DonDatTourId" />
                                <button type="submit" class="btn btn-outline-danger btn-sm">
                                    <i class="bi bi-x-circle me-1"></i>Hủy đơn
                                </button>
                            </form>
                        }

                        @* Thanh toán *@
                        @if (don.TrangThaiThanhToan == "ChuaThanhToan" && don.TrangThaiDon != "DaHuy")
                        {
                            <a asp-controller="ThanhToan" asp-action="ThanhToanDon" asp-route-id="@don.DonDatTourId"
                               class="btn btn-success btn-sm">
                                <i class="bi bi-wallet2 me-1"></i>Thanh toán
                            </a>
                        }
                        else if (don.TrangThaiThanhToan == "DaThanhToan")
                        {
                            <span class="badge bg-success ms-2">
                                <i class="bi bi-check-circle me-1"></i>Đã thanh toán
                            </span>
                        }
                    </div>
                </div>
            </div>
        }
    </div>
}

@section Styles {
    <style>
        /* ====== PAGE HEADER ====== */
        .page-header {
            padding: 1.5rem 0;
            border-bottom: 2px solid #f0f0f0;
        }

        /* ====== EMPTY STATE ====== */
        .empty-state {
            text-align: center;
            padding: 5rem 2rem;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 8px 20px rgba(15, 23, 42, 0.06);
        }

        .empty-state-icon {
            font-size: 6rem;
            color: #cbd5e1;
            margin-bottom: 1.5rem;
        }

        .empty-state-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 0.75rem;
        }

        .empty-state-text {
            font-size: 1rem;
            color: #64748b;
            max-width: 500px;
            margin: 0 auto;
        }

        /* ====== STAT CARDS ====== */
        .stat-card {
            background: #fff;
            border-radius: 12px;
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            box-shadow: 0 4px 12px rgba(15, 23, 42, 0.05);
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }

            .stat-card:hover {
                transform: translateY(-4px);
                box-shadow: 0 12px 24px rgba(15, 23, 42, 0.1);
            }

        .stat-card-primary {
            border-left-color: #0d6efd;
        }

        .stat-card-warning {
            border-left-color: #ffc107;
        }

        .stat-card-success {
            border-left-color: #198754;
        }

        .stat-card-info {
            border-left-color: #0dcaf0;
        }

        .stat-card-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            flex-shrink: 0;
        }

        .stat-card-primary .stat-card-icon {
            background: rgba(13, 110, 253, 0.1);
            color: #0d6efd;
        }

        .stat-card-warning .stat-card-icon {
            background: rgba(255, 193, 7, 0.1);
            color: #ffc107;
        }

        .stat-card-success .stat-card-icon {
            background: rgba(25, 135, 84, 0.1);
            color: #198754;
        }

        .stat-card-info .stat-card-icon {
            background: rgba(13, 202, 240, 0.1);
            color: #0dcaf0;
        }

        .stat-card-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: #1e293b;
            line-height: 1;
            margin-bottom: 0.25rem;
        }

        .stat-card-label {
            font-size: 0.875rem;
            color: #64748b;
            font-weight: 500;
        }

        /* ====== ORDER CARD ====== */
        .order-card {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(15, 23, 42, 0.06);
            overflow: hidden;
            transition: all 0.3s ease;
            border: 1px solid #f0f0f0;
        }

            .order-card:hover {
                transform: translateY(-4px);
                box-shadow: 0 12px 24px rgba(15, 23, 42, 0.12);
            }

        .order-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.25rem 1.5rem;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .order-info {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .order-id {
            font-size: 1rem;
            font-weight: 600;
            color: #1e293b;
        }

            .order-id i {
                color: #64748b;
                margin-right: 0.25rem;
            }

        .order-date {
            font-size: 0.875rem;
            color: #64748b;
        }

        .order-card-body {
            padding: 1.5rem;
        }

        /* Tour Info */
        .tour-name {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 1rem;
            line-height: 1.4;
        }

        .tour-details {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9375rem;
        }

            .detail-item i {
                color: #64748b;
                font-size: 1rem;
                width: 20px;
            }

        .detail-label {
            color: #64748b;
            font-weight: 500;
        }

        .detail-value {
            color: #1e293b;
            font-weight: 600;
        }

        /* Payment Section */
        .payment-section {
            background: #f8fafc;
            border-radius: 12px;
            padding: 1.25rem;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .badge-payment {
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.875rem;
            font-weight: 600;
        }

            .badge-payment.success {
                background: rgba(25, 135, 84, 0.1);
                color: #198754;
            }

            .badge-payment.warning {
                background: rgba(255, 193, 7, 0.1);
                color: #856404;
            }

        .total-price {
            text-align: center;
            padding-top: 1rem;
            border-top: 2px dashed #e2e8f0;
        }

        .price-label {
            font-size: 0.875rem;
            color: #64748b;
            margin-bottom: 0.5rem;
        }

        .price-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: #dc3545;
        }

        /* Footer Actions */
        .order-card-footer {
            padding: 1rem 1.5rem;
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
        }

        .action-buttons {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            align-items: center;
        }

            .action-buttons .btn {
                font-weight: 600;
                border-radius: 8px;
                padding: 0.5rem 1rem;
                transition: all 0.3s ease;
            }

                .action-buttons .btn:hover {
                    transform: translateY(-2px);
                }

        /* Badge Status */
        .badge-status {
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.875rem;
            font-weight: 600;
        }

            .badge-status.warning {
                background: rgba(255, 193, 7, 0.1);
                color: #856404;
            }

            .badge-status.success {
                background: rgba(25, 135, 84, 0.1);
                color: #198754;
            }

            .badge-status.danger {
                background: rgba(220, 53, 69, 0.1);
                color: #842029;
            }

            .badge-status.info {
                background: rgba(13, 202, 240, 0.1);
                color: #055160;
            }

            .badge-status.secondary {
                background: rgba(108, 117, 125, 0.1);
                color: #495057;
            }

        /* Responsive */
        @@media (max-width: 768px) {
            .page-header .d-flex {
                flex-direction: column;
                align-items: flex-start !important;
                gap: 1rem;
            }

            .order-card-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.75rem;
            }

            .order-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .payment-section {
                margin-top: 1rem;
            }

            .action-buttons {
                flex-direction: column;
            }

                .action-buttons .btn,
                .action-buttons form {
                    width: 100%;
                }

                .action-buttons .btn {
                    width: 100%;
                }

            .stat-card {
                padding: 1rem;
            }

            .stat-card-icon {
                width: 50px;
                height: 50px;
                font-size: 1.5rem;
            }

            .stat-card-value {
                font-size: 1.4rem;
            }
        }
    </style>
}